import{a as K,b as p,c as Q,d as W,e as X,f as Y,g as Z,h as ee,i as D,j as U,k as te,l as ie}from"./chunk-HLOO6DOA.js";import{a as T}from"./chunk-JFRZ6SEX.js";import{$ as O,B as f,C as u,E as i,F as t,G as E,H as I,I as g,J as m,K as R,L as k,M as o,N as C,O as y,Q as G,T as N,U as L,V as q,W as z,ba as J,c as V,ca as H,d as A,da as F,f as P,j,k as B,m as w,o as x,p as M,s as _,t as v,x as c,y as d}from"./chunk-RQ4T6MHR.js";var S=(()=>{let r=class r{constructor(e,n){this.http=e,this.auth=n,this.selectedClient=new A(0),this.selectedClient$=this.selectedClient.asObservable(),this.apiUrl=H.apiUrl}getAllClients(){return this.http.get(`${this.apiUrl}/client`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.auth.user.value?.access_token}`}})}getClient(e){return this.http.get(`${this.apiUrl}/client/${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.auth.user.value?.access_token}`}})}createClient(e){this.http.post(`${this.apiUrl}/client`,e,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.auth.user.value?.access_token}`}}).subscribe()}updateClient(e,n){return this.http.patch(`${this.apiUrl}/client/${e}`,n,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.auth.user.value?.access_token}`}})}removeClient(e){return this.http.delete(`${this.apiUrl}/client/${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.auth.user.value?.access_token}`}})}};r.\u0275fac=function(n){return new(n||r)(w(z),w(F))},r.\u0275prov=j({token:r,factory:r.\u0275fac});let l=r;return l})();function de(l,r){l&1&&(i(0,"div"),o(1,"you should log in first!"),t())}function pe(l,r){if(l&1){let s=I();i(0,"div")(1,"button",5),g("click",function(){_(s);let n=m(2);return v(n.addCLient())}),o(2,"Add Client"),t(),i(3,"button",6),g("click",function(){_(s);let n=m(2);return v(n.onToggleClients())}),o(4),t()()}if(l&2){let s=m(2);c(4),y(" ",s.toggleClients?"Show My Clients":"Show All Clients"," ")}}function he(l,r){l&1&&(i(0,"th"),o(1,"ACTIONS"),t())}function fe(l,r){if(l&1){let s=I();i(0,"td",13)(1,"button",6),g("click",function(){_(s);let n=m().$implicit,a=m(2);return v(a.editClient(n.accountNumber))}),o(2," EDIT "),t(),i(3,"button",14),g("click",function(){_(s);let n=m().$implicit,a=m(2);return v(a.deleteCLient(n.accountNumber))}),o(4," DELETE "),t()()}}function ge(l,r){if(l&1){let s=I();i(0,"tr")(1,"td"),o(2),t(),i(3,"td"),o(4),t(),i(5,"td"),o(6),t(),i(7,"td"),o(8),t(),i(9,"td"),o(10),t(),i(11,"td"),o(12),t(),i(13,"td"),o(14),t(),i(15,"td")(16,"select",7,1),g("change",function(){let n=_(s).$implicit,a=k(17),h=m(2);return v(h.changeStatus(n.accountNumber,a.value))}),i(18,"option",8),o(19," PENDING "),t(),i(20,"option",9),o(21," IN_PROGRESS "),t(),i(22,"option",10),o(23," REJECTED "),t(),i(24,"option",11),o(25," CLOSED "),t()()(),f(26,fe,5,0,"td",12),t()}if(l&2){let s=r.$implicit,e=m(2);c(2),C(s.accountNumber),c(2),C(s.surname),c(2),C(s.name),c(2),C(s.patronymic),c(2),C(s.dateOfBirth),c(2),C(s.inn),c(2),C(s.responsibleUser),c(4),u("selected",s.status==="PENDING"),c(2),u("selected",s.status==="IN_PROGRESS"),c(2),u("selected",s.status==="REJECTED"),c(2),u("selected",s.status==="CLOSED"),c(2),u("ngIf",e.loggedInUser==null?null:e.loggedInUser.isAdmin)}}function Ce(l,r){if(l&1&&(f(0,pe,5,1,"div",3),i(1,"table")(2,"thead")(3,"th"),o(4,"\u041D\u043E\u043C\u0435\u0440 \u0441\u0447\u0435\u0442\u0430"),t(),i(5,"th"),o(6,"\u0424\u0430\u043C\u0438\u043B\u0438\u044F"),t(),i(7,"th"),o(8,"\u0418\u043C\u044F"),t(),i(9,"th"),o(10,"\u041E\u0442\u0447\u0435\u0441\u0442\u0432\u043E"),t(),i(11,"th"),o(12,"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F"),t(),i(13,"th"),o(14,"\u0418\u041D\u041D"),t(),i(15,"th"),o(16,"\u0424\u0418\u041E \u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u043E\u0433\u043E"),t(),i(17,"th"),o(18,"\u0421\u0442\u0430\u0442\u0443\u0441"),t(),f(19,he,2,0,"th",3),t(),i(20,"tbody"),f(21,ge,27,12,"tr",4),t()()),l&2){let s=m();u("ngIf",s.loggedInUser==null?null:s.loggedInUser.isAdmin),c(19),u("ngIf",s.loggedInUser==null?null:s.loggedInUser.isAdmin),c(2),u("ngForOf",s.clients)}}var re=(()=>{let r=class r{constructor(e,n,a,h){this.authService=e,this.clientService=n,this.userService=a,this.router=h,this.toggleClients=!0}ngOnInit(){this.authService.user$.subscribe(e=>this.loggedInUser=e),this.loggedInUser&&(this.loggedInUser?.isAdmin?this.clientService.getAllClients().subscribe(e=>{this.clients=e}):this.userService.getUser(this.loggedInUser?.id).subscribe(e=>{this.clients=e.clients}))}addCLient(){this.clientService.selectedClient.next(0),this.router.navigate(["client"])}editClient(e){this.clientService.selectedClient.next(e),this.router.navigate(["client"])}deleteCLient(e){this.clientService.removeClient(e).subscribe(()=>{alert("client has deleted"),this.clientService.getAllClients().subscribe(n=>{this.clients=n})})}changeStatus(e,n){this.clientService.getClient(e).subscribe(a=>{a.status=n,this.clientService.updateClient(e,a).subscribe(()=>console.log("changed"))})}onToggleClients(){this.toggleClients=!this.toggleClients,this.toggleClients?this.clientService.getAllClients().subscribe(e=>{this.clients=e}):this.userService.getUser(this.loggedInUser?.id).subscribe(e=>this.clients=e.clients)}};r.\u0275fac=function(n){return new(n||r)(d(F),d(S),d(T),d(O))},r.\u0275cmp=x({type:r,selectors:[["app-clients"]],decls:3,vars:2,consts:[["elseBlock",""],["status",""],[4,"ngIf","ngIfElse"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"add",3,"click"],[1,"edit",3,"click"],[3,"change"],["value","PENDING",3,"selected"],["value","IN_PROGRESS",3,"selected"],["value","REJECTED",3,"selected"],["value","CLOSED",3,"selected"],["class","actions",4,"ngIf"],[1,"actions"],[1,"delete",3,"click"]],template:function(n,a){if(n&1&&f(0,de,2,0,"div",2)(1,Ce,22,3,"ng-template",null,0,G),n&2){let h=k(2);u("ngIf",!a.loggedInUser)("ngIfElse",h)}},dependencies:[D,U,N,L],styles:["button[_ngcontent-%COMP%]{border:1px solid var(--color-light);cursor:pointer;color:var(--color-light);width:fit-content;padding:.4rem;font-weight:700}.add[_ngcontent-%COMP%]{background-color:green;margin-bottom:.4rem;width:6rem}.actions[_ngcontent-%COMP%]{display:flex;border:none;justify-content:space-evenly;align-items:center}.edit[_ngcontent-%COMP%]{background-color:#00f}.delete[_ngcontent-%COMP%]{background-color:red}"]});let l=r;return l})();function _e(l,r){if(l&1&&(i(0,"option",21),o(1),t()),l&2){let s=r.$implicit;R("value",s.id),c(),y(" ",s.fullName," ")}}var oe=(()=>{let r=class r{constructor(e,n,a,h){this.fb=e,this.userService=n,this.clientService=a,this.router=h,this.users=[],this.userService.getAllUsers().pipe(P(le=>{le.map(b=>{this.users.push({id:b.id,fullName:`${b.surname} ${b.name} ${b.patronymic}`})})})).subscribe()}initialForm(){this.clientForm=this.fb.group({surname:this.fb.control("",[p.required]),name:this.fb.control("",[p.required]),patronymic:this.fb.control(""),dateOfBirth:this.fb.control("",[p.required]),inn:this.fb.control("",[p.required,p.minLength(10),p.maxLength(10),p.pattern("^[0-9]{10}$")]),responsibleUser:this.fb.control("",[p.required]),status:this.fb.control("PENDING",[p.required])})}ngOnInit(){return V(this,null,function*(){this.initialForm(),this.clientService.selectedClient$.subscribe(e=>{this.selectedClient=e,this.clientService.getClient(e).subscribe(n=>{this.editClient=n,this.selectedClient!==0&&(this.clientForm.controls.surname.setValue(this.editClient?.surname),this.clientForm.controls.name.setValue(this.editClient?.name),this.clientForm.controls.patronymic.setValue(this.editClient?.patronymic),this.clientForm.controls.dateOfBirth.setValue(this.editClient?.dateOfBirth),this.clientForm.controls.inn.setValue(this.editClient?.inn),this.clientForm.controls.responsibleUser.setValue(this.editClient?.userId),this.clientForm.controls.status.setValue(this.editClient?.status))})})})}onSubmit(){let e=this.users.find(a=>a.id===Number(this.clientForm.controls.responsibleUser.value)),n={surname:this.clientForm.controls.surname.value,name:this.clientForm.controls.name.value,patronymic:this.clientForm.controls.patronymic.value,dateOfBirth:this.clientForm.controls.dateOfBirth.value,inn:this.clientForm.controls.inn.value,status:this.clientForm.controls.status.value,userId:this.clientForm.controls.responsibleUser.value,responsibleUser:e?.fullName};this.selectedClient==0?(this.clientService.createClient(n),alert("client has added")):(this.clientService.updateClient(this.selectedClient,n).subscribe(),alert("client has edited")),this.router.navigate(["clients"])}};r.\u0275fac=function(n){return new(n||r)(d(te),d(T),d(S),d(O))},r.\u0275cmp=x({type:r,selectors:[["app-client"]],decls:33,vars:5,consts:[[3,"ngSubmit","formGroup"],[1,"input-wrapper-fullname"],["type","text","id","surname","formControlName","surname","autocomplete","off","placeholder","\u0424\u0430\u043C\u0438\u043B\u0438\u044F"],["type","text","id","name","formControlName","name","autocomplete","off","placeholder","\u0418\u043C\u044F"],["type","text","id","patronymic","formControlName","patronymic","autocomplete","off","placeholder","\u041E\u0442\u0447\u0435\u0441\u0442\u0432\u043E"],[1,"input-wrapper"],["for","dateOfBirth"],["type","date","min","1970-1-1","id","dateOfBirth","name","dateOfBirth","formControlName","dateOfBirth"],["for","inn"],["type","text","id","inn","formControlName","inn","autocomplete","off","placeholder","Enter a 10 digits INN number"],["for","responsibleUser"],["id","responsibleUser","formControlName","responsibleUser"],["value","","disabled","","selected","","hidden",""],[3,"value",4,"ngFor","ngForOf"],["for","status"],["id","status","formControlName","status"],["value","PENDING",3,"defaultSelected","selected"],["value","IN_PROGRESS"],["value","REJECTED"],["value","CLOSED"],["type","submit",3,"value","disabled"],[3,"value"]],template:function(n,a){n&1&&(i(0,"form",0),g("ngSubmit",function(){return a.onSubmit()}),i(1,"div",1),E(2,"input",2)(3,"input",3)(4,"input",4),t(),i(5,"div",5)(6,"label",6),o(7,"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F"),t(),E(8,"input",7),t(),i(9,"div",5)(10,"label",8),o(11,"\u0418\u041D\u041D"),t(),E(12,"input",9),t(),i(13,"div",5)(14,"label",10),o(15,"\u0424\u0418\u041E \u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u043E\u0433\u043E"),t(),i(16,"select",11)(17,"option",12),o(18,"-- Choose a User --"),t(),f(19,_e,2,2,"option",13),t()(),i(20,"div",5)(21,"label",14),o(22,"\u0421\u0442\u0430\u0442\u0443\u0441"),t(),i(23,"select",15)(24,"option",16),o(25," PENDING "),t(),i(26,"option",17),o(27,"IN_PROGRESS"),t(),i(28,"option",18),o(29,"REJECTED"),t(),i(30,"option",19),o(31,"CLOSED"),t()()(),E(32,"input",20),t()),n&2&&(u("formGroup",a.clientForm),c(19),u("ngForOf",a.users),c(5),u("defaultSelected",!0),c(8),u("value",a.selectedClient!==0?"EDIT":"ADD")("disabled",!a.clientForm.valid))},dependencies:[X,D,U,K,ee,Q,W,Y,Z,N],styles:["form[_ngcontent-%COMP%]{max-width:40rem;background:transparent;padding:2rem;margin:2rem auto;box-shadow:1px 1px 10px var(--color-effect);border-radius:.6rem;gap:1.6rem}.input-wrapper-fullname[_ngcontent-%COMP%]{display:flex;gap:1.5rem}input[_ngcontent-%COMP%]{height:2rem;padding:0 1rem;outline:none;border:none;width:100%;background-color:#fff;color:#000}select[_ngcontent-%COMP%]{height:2rem}option[_ngcontent-%COMP%]{height:2rem;background-color:transparent}input[type=submit][_ngcontent-%COMP%]{background-color:var(--color-logo);outline:none;border:none;margin-top:1rem}"]});let l=r;return l})();var ve=[{path:"clients",component:re},{path:"client",component:oe}],$e=(()=>{let r=class r{};r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=M({type:r}),r.\u0275inj=B({providers:[S],imports:[J.forChild(ve),ie,q]});let l=r;return l})();export{$e as ClientModule};
