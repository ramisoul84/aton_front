import{a as K,b as p,c as Q,d as W,e as X,f as Y,g as Z,h as ee,i as F,j as D,k as te,l as ie}from"./chunk-MTBLURCK.js";import{a as U}from"./chunk-XMYFCG4W.js";import{$ as O,B as f,C as u,E as i,F as t,G as E,H as I,I as g,J as m,K as B,L as w,M as l,N as C,O as y,Q as j,T as N,U as G,V as L,W as q,ba as J,c as V,ca as H,d as P,da as z,f as k,j as M,k as R,m as $,o as x,p as A,s as _,t as v,x as a,y as d}from"./chunk-37CQUT2T.js";var S=(()=>{let n=class n{constructor(e){this.http=e,this.selectedClient=new P(0),this.selectedClient$=this.selectedClient.asObservable(),this.apiUrl=H.apiUrl}getAllClients(){return this.http.get(`${this.apiUrl}/client`)}getClient(e){return this.http.get(`${this.apiUrl}/client/${e}`)}createClient(e){this.http.post(`${this.apiUrl}/client`,e).subscribe()}updateClient(e,r){return this.http.patch(`${this.apiUrl}/client/${e}`,r)}removeClient(e){return this.http.delete(`${this.apiUrl}/client/${e}`)}};n.\u0275fac=function(r){return new(r||n)($(q))},n.\u0275prov=M({token:n,factory:n.\u0275fac});let o=n;return o})();function me(o,n){o&1&&(i(0,"div"),l(1,"you should log in first!"),t())}function de(o,n){if(o&1){let s=I();i(0,"div")(1,"button",5),g("click",function(){_(s);let r=m(2);return v(r.addCLient())}),l(2,"Add Client"),t(),i(3,"button",6),g("click",function(){_(s);let r=m(2);return v(r.onToggleClients())}),l(4),t()()}if(o&2){let s=m(2);a(4),y(" ",s.toggleClients?"Show My Clients":"Show All Clients"," ")}}function pe(o,n){o&1&&(i(0,"th"),l(1,"ACTIONS"),t())}function he(o,n){if(o&1){let s=I();i(0,"td",13)(1,"button",6),g("click",function(){_(s);let r=m().$implicit,c=m(2);return v(c.editClient(r.accountNumber))}),l(2," EDIT "),t(),i(3,"button",14),g("click",function(){_(s);let r=m().$implicit,c=m(2);return v(c.deleteCLient(r.accountNumber))}),l(4," DELETE "),t()()}}function fe(o,n){if(o&1){let s=I();i(0,"tr")(1,"td"),l(2),t(),i(3,"td"),l(4),t(),i(5,"td"),l(6),t(),i(7,"td"),l(8),t(),i(9,"td"),l(10),t(),i(11,"td"),l(12),t(),i(13,"td"),l(14),t(),i(15,"td")(16,"select",7,1),g("change",function(){let r=_(s).$implicit,c=w(17),h=m(2);return v(h.changeStatus(r.accountNumber,c.value))}),i(18,"option",8),l(19," PENDING "),t(),i(20,"option",9),l(21," IN_PROGRESS "),t(),i(22,"option",10),l(23," REJECTED "),t(),i(24,"option",11),l(25," CLOSED "),t()()(),f(26,he,5,0,"td",12),t()}if(o&2){let s=n.$implicit,e=m(2);a(2),C(s.accountNumber),a(2),C(s.surname),a(2),C(s.name),a(2),C(s.patronymic),a(2),C(s.dateOfBirth),a(2),C(s.inn),a(2),C(s.responsibleUser),a(4),u("selected",s.status==="PENDING"),a(2),u("selected",s.status==="IN_PROGRESS"),a(2),u("selected",s.status==="REJECTED"),a(2),u("selected",s.status==="CLOSED"),a(2),u("ngIf",e.loggedInUser==null?null:e.loggedInUser.isAdmin)}}function ge(o,n){if(o&1&&(f(0,de,5,1,"div",3),i(1,"table")(2,"thead")(3,"th"),l(4,"\u041D\u043E\u043C\u0435\u0440 \u0441\u0447\u0435\u0442\u0430"),t(),i(5,"th"),l(6,"\u0424\u0430\u043C\u0438\u043B\u0438\u044F"),t(),i(7,"th"),l(8,"\u0418\u043C\u044F"),t(),i(9,"th"),l(10,"\u041E\u0442\u0447\u0435\u0441\u0442\u0432\u043E"),t(),i(11,"th"),l(12,"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F"),t(),i(13,"th"),l(14,"\u0418\u041D\u041D"),t(),i(15,"th"),l(16,"\u0424\u0418\u041E \u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u043E\u0433\u043E"),t(),i(17,"th"),l(18,"\u0421\u0442\u0430\u0442\u0443\u0441"),t(),f(19,pe,2,0,"th",3),t(),i(20,"tbody"),f(21,fe,27,12,"tr",4),t()()),o&2){let s=m();u("ngIf",s.loggedInUser==null?null:s.loggedInUser.isAdmin),a(19),u("ngIf",s.loggedInUser==null?null:s.loggedInUser.isAdmin),a(2),u("ngForOf",s.clients)}}var re=(()=>{let n=class n{constructor(e,r,c,h){this.authService=e,this.clientService=r,this.userService=c,this.router=h,this.toggleClients=!0}ngOnInit(){this.authService.user$.subscribe(e=>this.loggedInUser=e),this.loggedInUser&&(this.loggedInUser?.isAdmin?this.clientService.getAllClients().subscribe(e=>{this.clients=e}):this.userService.getUser(this.loggedInUser?.id).subscribe(e=>{this.clients=e.clients}))}addCLient(){this.clientService.selectedClient.next(0),this.router.navigate(["client"])}editClient(e){this.clientService.selectedClient.next(e),this.router.navigate(["client"])}deleteCLient(e){this.clientService.removeClient(e).subscribe(()=>{alert("client has deleted"),this.clientService.getAllClients().subscribe(r=>{this.clients=r})})}changeStatus(e,r){this.clientService.getClient(e).subscribe(c=>{c.status=r,this.clientService.updateClient(e,c).subscribe(()=>console.log("changed"))})}onToggleClients(){this.toggleClients=!this.toggleClients,this.toggleClients?this.clientService.getAllClients().subscribe(e=>{this.clients=e}):this.userService.getUser(this.loggedInUser?.id).subscribe(e=>this.clients=e.clients)}};n.\u0275fac=function(r){return new(r||n)(d(z),d(S),d(U),d(O))},n.\u0275cmp=x({type:n,selectors:[["app-clients"]],decls:3,vars:2,consts:[["elseBlock",""],["status",""],[4,"ngIf","ngIfElse"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"add",3,"click"],[1,"edit",3,"click"],[3,"change"],["value","PENDING",3,"selected"],["value","IN_PROGRESS",3,"selected"],["value","REJECTED",3,"selected"],["value","CLOSED",3,"selected"],["class","actions",4,"ngIf"],[1,"actions"],[1,"delete",3,"click"]],template:function(r,c){if(r&1&&f(0,me,2,0,"div",2)(1,ge,22,3,"ng-template",null,0,j),r&2){let h=w(2);u("ngIf",!c.loggedInUser)("ngIfElse",h)}},dependencies:[F,D,N,G],styles:["button[_ngcontent-%COMP%]{border:1px solid var(--color-light);cursor:pointer;color:var(--color-light);width:fit-content;padding:.4rem;font-weight:700}.add[_ngcontent-%COMP%]{background-color:green;margin-bottom:.4rem;width:6rem}.actions[_ngcontent-%COMP%]{display:flex;border:none;justify-content:space-evenly;align-items:center}.edit[_ngcontent-%COMP%]{background-color:#00f}.delete[_ngcontent-%COMP%]{background-color:red}"]});let o=n;return o})();function Ce(o,n){if(o&1&&(i(0,"option",21),l(1),t()),o&2){let s=n.$implicit;B("value",s.id),a(),y(" ",s.fullName," ")}}var le=(()=>{let n=class n{constructor(e,r,c,h){this.fb=e,this.userService=r,this.clientService=c,this.router=h,this.users=[],this.userService.getAllUsers().pipe(k(oe=>{oe.map(b=>{this.users.push({id:b.id,fullName:`${b.surname} ${b.name} ${b.patronymic}`})})})).subscribe()}initialForm(){this.clientForm=this.fb.group({surname:this.fb.control("",[p.required]),name:this.fb.control("",[p.required]),patronymic:this.fb.control(""),dateOfBirth:this.fb.control("",[p.required]),inn:this.fb.control("",[p.required,p.minLength(10),p.maxLength(10),p.pattern("^[0-9]{10}$")]),responsibleUser:this.fb.control("",[p.required]),status:this.fb.control("PENDING",[p.required])})}ngOnInit(){return V(this,null,function*(){this.initialForm(),this.clientService.selectedClient$.subscribe(e=>{this.selectedClient=e,this.clientService.getClient(e).subscribe(r=>{this.editClient=r,this.selectedClient!==0&&(this.clientForm.controls.surname.setValue(this.editClient?.surname),this.clientForm.controls.name.setValue(this.editClient?.name),this.clientForm.controls.patronymic.setValue(this.editClient?.patronymic),this.clientForm.controls.dateOfBirth.setValue(this.editClient?.dateOfBirth),this.clientForm.controls.inn.setValue(this.editClient?.inn),this.clientForm.controls.responsibleUser.setValue(this.editClient?.userId),this.clientForm.controls.status.setValue(this.editClient?.status))})})})}onSubmit(){let e=this.users.find(c=>c.id===Number(this.clientForm.controls.responsibleUser.value)),r={surname:this.clientForm.controls.surname.value,name:this.clientForm.controls.name.value,patronymic:this.clientForm.controls.patronymic.value,dateOfBirth:this.clientForm.controls.dateOfBirth.value,inn:this.clientForm.controls.inn.value,status:this.clientForm.controls.status.value,userId:this.clientForm.controls.responsibleUser.value,responsibleUser:e?.fullName};this.selectedClient==0?(this.clientService.createClient(r),alert("client has added")):(this.clientService.updateClient(this.selectedClient,r).subscribe(),alert("client has edited")),this.router.navigate(["clients"])}};n.\u0275fac=function(r){return new(r||n)(d(te),d(U),d(S),d(O))},n.\u0275cmp=x({type:n,selectors:[["app-client"]],decls:33,vars:5,consts:[[3,"ngSubmit","formGroup"],[1,"input-wrapper-fullname"],["type","text","id","surname","formControlName","surname","autocomplete","off","placeholder","\u0424\u0430\u043C\u0438\u043B\u0438\u044F"],["type","text","id","name","formControlName","name","autocomplete","off","placeholder","\u0418\u043C\u044F"],["type","text","id","patronymic","formControlName","patronymic","autocomplete","off","placeholder","\u041E\u0442\u0447\u0435\u0441\u0442\u0432\u043E"],[1,"input-wrapper"],["for","dateOfBirth"],["type","date","min","1970-1-1","id","dateOfBirth","name","dateOfBirth","formControlName","dateOfBirth"],["for","inn"],["type","text","id","inn","formControlName","inn","autocomplete","off","placeholder","Enter a 10 digits INN number"],["for","responsibleUser"],["id","responsibleUser","formControlName","responsibleUser"],["value","","disabled","","selected","","hidden",""],[3,"value",4,"ngFor","ngForOf"],["for","status"],["id","status","formControlName","status"],["value","PENDING",3,"defaultSelected","selected"],["value","IN_PROGRESS"],["value","REJECTED"],["value","CLOSED"],["type","submit",3,"value","disabled"],[3,"value"]],template:function(r,c){r&1&&(i(0,"form",0),g("ngSubmit",function(){return c.onSubmit()}),i(1,"div",1),E(2,"input",2)(3,"input",3)(4,"input",4),t(),i(5,"div",5)(6,"label",6),l(7,"\u0414\u0430\u0442\u0430 \u0440\u043E\u0436\u0434\u0435\u043D\u0438\u044F"),t(),E(8,"input",7),t(),i(9,"div",5)(10,"label",8),l(11,"\u0418\u041D\u041D"),t(),E(12,"input",9),t(),i(13,"div",5)(14,"label",10),l(15,"\u0424\u0418\u041E \u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u043E\u0433\u043E"),t(),i(16,"select",11)(17,"option",12),l(18,"-- Choose a User --"),t(),f(19,Ce,2,2,"option",13),t()(),i(20,"div",5)(21,"label",14),l(22,"\u0421\u0442\u0430\u0442\u0443\u0441"),t(),i(23,"select",15)(24,"option",16),l(25," PENDING "),t(),i(26,"option",17),l(27,"IN_PROGRESS"),t(),i(28,"option",18),l(29,"REJECTED"),t(),i(30,"option",19),l(31,"CLOSED"),t()()(),E(32,"input",20),t()),r&2&&(u("formGroup",c.clientForm),a(19),u("ngForOf",c.users),a(5),u("defaultSelected",!0),a(8),u("value",c.selectedClient!==0?"EDIT":"ADD")("disabled",!c.clientForm.valid))},dependencies:[X,F,D,K,ee,Q,W,Y,Z,N],styles:["form[_ngcontent-%COMP%]{max-width:40rem;background:transparent;padding:2rem;margin:2rem auto;box-shadow:1px 1px 10px var(--color-effect);border-radius:.6rem;gap:1.6rem}.input-wrapper-fullname[_ngcontent-%COMP%]{display:flex;gap:1.5rem}input[_ngcontent-%COMP%]{height:2rem;padding:0 1rem;outline:none;border:none;width:100%;background-color:#fff;color:#000}select[_ngcontent-%COMP%]{height:2rem}option[_ngcontent-%COMP%]{height:2rem;background-color:transparent}input[type=submit][_ngcontent-%COMP%]{background-color:var(--color-logo);outline:none;border:none;margin-top:1rem}"]});let o=n;return o})();var _e=[{path:"clients",component:re},{path:"client",component:le}],Pe=(()=>{let n=class n{};n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=A({type:n}),n.\u0275inj=R({providers:[S],imports:[J.forChild(_e),ie,L]});let o=n;return o})();export{Pe as ClientModule};
